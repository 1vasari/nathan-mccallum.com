<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>To Import, or Perhaps Not? | Nathan McCallum</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="To Import, or Perhaps Not?" />
<meta name="author" content="Nathan McCallum" />
<meta property="og:locale" content="en" />
<meta name="description" content="I keep a journal using a little Rails app I built. Nothing super fancy. It’s just so I can write what I’m thinking and feeling throughout the day. Every so often I look back and think about whether I’m okay with how things are going." />
<meta property="og:description" content="I keep a journal using a little Rails app I built. Nothing super fancy. It’s just so I can write what I’m thinking and feeling throughout the day. Every so often I look back and think about whether I’m okay with how things are going." />
<link rel="canonical" href="http://nathan-mccallum.com/to-import/" />
<meta property="og:url" content="http://nathan-mccallum.com/to-import/" />
<meta property="og:site_name" content="Nathan McCallum" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-23T00:00:00+10:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="To Import, or Perhaps Not?" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://nathan-mccallum.com/to-import/","headline":"To Import, or Perhaps Not?","dateModified":"2020-09-23T00:00:00+10:00","datePublished":"2020-09-23T00:00:00+10:00","author":{"@type":"Person","name":"Nathan McCallum"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://nathan-mccallum.com/to-import/"},"description":"I keep a journal using a little Rails app I built. Nothing super fancy. It’s just so I can write what I’m thinking and feeling throughout the day. Every so often I look back and think about whether I’m okay with how things are going.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="text/plain" rel="author" href="/humans.txt">
    
    <style>
    html { line-height: 1.15; -webkit-text-size-adjust: 100%; }

body { margin: 0; }

main { display: block; }

h1 { font-size: 2em; margin: 0.67em 0; }

hr { box-sizing: content-box; height: 0; overflow: visible; }

pre { font-family: monospace, monospace; font-size: 1em; }

a { background-color: transparent; }

abbr[title] { border-bottom: none; text-decoration: underline; text-decoration: underline dotted; }

b, strong { font-weight: bolder; }

code, kbd, samp { font-family: monospace, monospace; font-size: 1em; }

small { font-size: 80%; }

sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sub { bottom: -0.25em; }

sup { top: -0.5em; }

img { border-style: none; }

button, input, optgroup, select, textarea { font-family: inherit; font-size: 100%; line-height: 1.15; margin: 0; }

button, input { overflow: visible; }

button, select { text-transform: none; }

button, [type="button"], [type="reset"], [type="submit"] { -webkit-appearance: button; }

button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner { border-style: none; padding: 0; }

button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring { outline: 1px dotted ButtonText; }

fieldset { padding: 0.35em 0.75em 0.625em; }

legend { box-sizing: border-box; color: inherit; display: table; max-width: 100%; padding: 0; white-space: normal; }

progress { vertical-align: baseline; }

textarea { overflow: auto; }

[type="checkbox"], [type="radio"] { box-sizing: border-box; padding: 0; }

[type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button { height: auto; }

[type="search"] { -webkit-appearance: textfield; outline-offset: -2px; }

[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

::-webkit-file-upload-button { -webkit-appearance: button; font: inherit; }

details { display: block; }

summary { display: list-item; }

template { display: none; }

[hidden] { display: none; }

html { font-size: 62.5%; font-family: "Zilla Slab", "Times New Roman", serif; text-rendering: optimizeLegibility; -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; background-color: #050f1a; }

body { font-size: 1.8rem; line-height: 1.618; max-width: 38em; margin: auto; color: #bdbdbd; padding: 13px; }

@media (max-width: 684px) { body { font-size: 1.53rem; } }

@media (max-width: 382px) { body { font-size: 1.35rem; } }

h1, h2, h3, h4, h5, h6 { line-height: 1.1; font-family: "Zilla Slab", "Times New Roman", serif; font-weight: 400; margin-top: 3rem; margin-bottom: 1.5rem; overflow-wrap: break-word; word-wrap: break-word; -ms-word-break: break-all; word-break: break-word; -ms-hyphens: auto; -moz-hyphens: auto; -webkit-hyphens: auto; hyphens: auto; }

h1 { font-size: 2.35em; }

h2 { font-size: 2.00em; }

h3 { font-size: 1.75em; }

h4 { font-size: 1.5em; }

h5 { font-size: 1.25em; }

h6 { font-size: 1em; }

p { margin-top: 0px; margin-bottom: 2.5rem; }

small, sub, sup { font-size: 75%; }

hr { border-color: #2c8898; }

a { text-decoration: none; transition: color 0.1s; color: #d0931e; }

a:hover { color: #982c2c; border-bottom: 1px solid #4a4a4a; }

ul { padding-left: 1.4em; margin-top: 0px; margin-bottom: 2.5rem; }

li { margin-bottom: 0.4em; }

blockquote { font-style: italic; margin-left: 1.5em; padding-left: 1em; border-left: 3px solid #d0931e; }

img { height: auto; max-width: 100%; margin-top: 0px; margin-bottom: 2.5rem; }

pre { background-color: #373737ad; display: block; padding: 1em; overflow-x: auto; margin-top: 0px; margin-bottom: 2.5rem; }

code { font-size: 0.9em; padding: 0 0.5em; background-color: #373737ad; white-space: pre-wrap; }

pre > code { padding: 0; background-color: transparent; white-space: pre; }

pre, code { font-family: 'Inconsolata', monospace; }

table { text-align: justify; width: 100%; border-collapse: collapse; }

td, th { padding: 0.5em; border-bottom: 1px solid #373737ad; }

img { border-radius: 1em; width: auto; height: auto; max-height: 500px; display: block; margin: 0 auto; }

.embed-container { margin: 1em 0; }

.highlight .hll { background-color: #49483e; }

.highlight { background: #272822; color: #f8f8f2; }

.highlight .c { color: #75715e; }

/* Comment */
.highlight .err { color: #960050; background-color: #1e0010; }

/* Error */
.highlight .k { color: #66d9ef; }

/* Keyword */
.highlight .l { color: #ae81ff; }

/* Literal */
.highlight .n { color: #f8f8f2; }

/* Name */
.highlight .o { color: #f92672; }

/* Operator */
.highlight .p { color: #f8f8f2; }

/* Punctuation */
.highlight .ch { color: #75715e; }

/* Comment.Hashbang */
.highlight .cm { color: #75715e; }

/* Comment.Multiline */
.highlight .cp { color: #75715e; }

/* Comment.Preproc */
.highlight .cpf { color: #75715e; }

/* Comment.PreprocFile */
.highlight .c1 { color: #75715e; }

/* Comment.Single */
.highlight .cs { color: #75715e; }

/* Comment.Special */
.highlight .gd { color: #f92672; }

/* Generic.Deleted */
.highlight .ge { font-style: italic; }

/* Generic.Emph */
.highlight .gi { color: #a6e22e; }

/* Generic.Inserted */
.highlight .gs { font-weight: bold; }

/* Generic.Strong */
.highlight .gu { color: #75715e; }

/* Generic.Subheading */
.highlight .kc { color: #66d9ef; }

/* Keyword.Constant */
.highlight .kd { color: #66d9ef; }

/* Keyword.Declaration */
.highlight .kn { color: #f92672; }

/* Keyword.Namespace */
.highlight .kp { color: #66d9ef; }

/* Keyword.Pseudo */
.highlight .kr { color: #66d9ef; }

/* Keyword.Reserved */
.highlight .kt { color: #66d9ef; }

/* Keyword.Type */
.highlight .ld { color: #e6db74; }

/* Literal.Date */
.highlight .m { color: #ae81ff; }

/* Literal.Number */
.highlight .s { color: #e6db74; }

/* Literal.String */
.highlight .na { color: #a6e22e; }

/* Name.Attribute */
.highlight .nb { color: #f8f8f2; }

/* Name.Builtin */
.highlight .nc { color: #a6e22e; }

/* Name.Class */
.highlight .no { color: #66d9ef; }

/* Name.Constant */
.highlight .nd { color: #a6e22e; }

/* Name.Decorator */
.highlight .ni { color: #f8f8f2; }

/* Name.Entity */
.highlight .ne { color: #a6e22e; }

/* Name.Exception */
.highlight .nf { color: #a6e22e; }

/* Name.Function */
.highlight .nl { color: #f8f8f2; }

/* Name.Label */
.highlight .nn { color: #f8f8f2; }

/* Name.Namespace */
.highlight .nx { color: #a6e22e; }

/* Name.Other */
.highlight .py { color: #f8f8f2; }

/* Name.Property */
.highlight .nt { color: #f92672; }

/* Name.Tag */
.highlight .nv { color: #f8f8f2; }

/* Name.Variable */
.highlight .ow { color: #f92672; }

/* Operator.Word */
.highlight .w { color: #f8f8f2; }

/* Text.Whitespace */
.highlight .mb { color: #ae81ff; }

/* Literal.Number.Bin */
.highlight .mf { color: #ae81ff; }

/* Literal.Number.Float */
.highlight .mh { color: #ae81ff; }

/* Literal.Number.Hex */
.highlight .mi { color: #ae81ff; }

/* Literal.Number.Integer */
.highlight .mo { color: #ae81ff; }

/* Literal.Number.Oct */
.highlight .sa { color: #e6db74; }

/* Literal.String.Affix */
.highlight .sb { color: #e6db74; }

/* Literal.String.Backtick */
.highlight .sc { color: #e6db74; }

/* Literal.String.Char */
.highlight .dl { color: #e6db74; }

/* Literal.String.Delimiter */
.highlight .sd { color: #e6db74; }

/* Literal.String.Doc */
.highlight .s2 { color: #e6db74; }

/* Literal.String.Double */
.highlight .se { color: #ae81ff; }

/* Literal.String.Escape */
.highlight .sh { color: #e6db74; }

/* Literal.String.Heredoc */
.highlight .si { color: #e6db74; }

/* Literal.String.Interpol */
.highlight .sx { color: #e6db74; }

/* Literal.String.Other */
.highlight .sr { color: #e6db74; }

/* Literal.String.Regex */
.highlight .s1 { color: #e6db74; }

/* Literal.String.Single */
.highlight .ss { color: #e6db74; }

/* Literal.String.Symbol */
.highlight .bp { color: #f8f8f2; }

/* Name.Builtin.Pseudo */
.highlight .fm { color: #a6e22e; }

/* Name.Function.Magic */
.highlight .vc { color: #f8f8f2; }

/* Name.Variable.Class */
.highlight .vg { color: #f8f8f2; }

/* Name.Variable.Global */
.highlight .vi { color: #f8f8f2; }

/* Name.Variable.Instance */
.highlight .vm { color: #f8f8f2; }

/* Name.Variable.Magic */
.highlight .il { color: #ae81ff; }

/* Literal.Number.Integer.Long */

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Zilla+Slab:ital@0;1&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap" rel="stylesheet">
  </head>

  <body>
    <h1>Nathan's Public Domicile</h1>

    <a href="/">Home</a> |
    <a href="/consulting">Consulting</a> |
    <a href="/projects">Projects</a>

    <h2>To Import, or Perhaps Not?</h2>

<p>
  <time datetime="2020-09-23T00:00:00+10:00">
    Sep 23, 2020
  </time>•&nbsp;Nathan McCallum&nbsp;•&nbsp;Programming</p>

<p>I keep a journal using a little Rails app I built. Nothing super fancy.
It’s just so I can write what I’m thinking and feeling throughout the day.
Every so often I look back and think about whether I’m okay with how things are going.</p>

<p>Some issues came up and I ended up merging my journalling app functionality into another personal project.
The application code was really simple but of course the old entries needed to get moved across as well.
So the objective was to get the entries out of the old Postgres database and into a new one.
Along the way one column needed to be renamed as well.</p>

<p><em>How hard can it be?</em></p>

<p>Ugh.</p>

<p>I first tried to use <a href="https://github.com/sferik/rails_admin">Rails Admin</a> to export the entries.
Soon afterward, I discovered that it doesn’t have an import function.
So it was possible to download the entries but not import them into the new database.</p>

<p>Next I tried to use <a href="https://www.pgadmin.org/">pgAdmin</a> to export the entries as some kind of <code class="language-plaintext highlighter-rouge">csv</code> file and then import them into the new database.
Was I able to get this to work? Nope!
The import always failed because of something wrong with the date format in the source file.</p>

<p>(This stunt was made particularly difficult by <a href="https://www.heroku.com/">Heroku</a> hobby datastores, which appear to contain hundreds of databases pertaining to different Heroku user’s applications. Obviously your user can only access your own database table but the performance implications were fascinating. It looked like there were 50-100 reads occurring every second. This is why it’s free and also slow sometimes!)</p>

<p><em>So what worked?</em></p>

<p>Okay, here we go:</p>

<ol>
  <li>Download a <code class="language-plaintext highlighter-rouge">json</code> file of the entires using Rails Admin</li>
  <li>Edit the file to make the column changes that were required</li>
  <li>Upload the file to a private Github Gist</li>
  <li>Run the following Ruby code in the <code class="language-plaintext highlighter-rouge">rails console</code> of the destination app:</li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'&lt;Github Gist url here&gt;'</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

<span class="n">entries</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
  <span class="n">e</span> <span class="o">=</span> <span class="no">PersonalLog</span><span class="o">::</span><span class="no">Entry</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">content</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">created_at</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">zone</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">])</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">updated_at</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">zone</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">'updated_at'</span><span class="p">])</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">save!</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This worked but I’m convinced that there was a better way eluding me.</p>

<p>‘Till next time, I guess.</p>


  </body>
</html>
